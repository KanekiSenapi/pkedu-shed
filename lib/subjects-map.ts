export const subjectsData = {
  "przedmioty_wspolne": {
    "oglne": [
      {
        "nazwa": "Pisanie tekstów specjalistycznych w języku angielskim",
        "skrot": "PTSJA",
        "semestr": 2,
        "rok": 1
      },
      {
        "nazwa": "Psychologia i socjologia pracy",
        "skrot": "PSP",
        "semestr": 1,
        "rok": 1
      }
    ],
    "kierunkowe": [
      {
        "nazwa": "Zaawansowane techniki programowania",
        "skrot": "ZTP",
        "semestr": 1,
        "rok": 1
      },
      {
        "nazwa": "Zaawansowane technologie baz danych",
        "skrot": "ZTBD",
        "semestr": 1,
        "rok": 1
      },
      {
        "nazwa": "Techniki projektowania frontendowego",
        "skrot": "TPF",
        "semestr": 2,
        "rok": 1
      },
      {
        "nazwa": "Programowanie równoległe i rozproszone",
        "skrot": "PRR",
        "semestr": 2,
        "rok": 1
      },
      {
        "nazwa": "Zarządzanie projektem informatycznym",
        "skrot": "ZPI",
        "semestr": 3,
        "rok": 2
      }
    ],
    "wybieralne": {
      "grupa_1": [
        {
          "nazwa": "Ekonomia menedżerska",
          "skrot": "EM"
        },
        {
          "nazwa": "Aktywny Inżynier",
          "skrot": "AI"
        },
        {
          "nazwa": "Psychologia motywacji, emocji i radzenia sobie ze stresem",
          "skrot": "PMERS"
        },
        {
          "nazwa": "Zarządzanie zmianą w organizacji",
          "skrot": "ZZO"
        }
      ]
    }
  },
  "cyberbezpieczenstwo": [
    {
      "nazwa": "Statystyka",
      "skrot": "STAT",
      "specjalizacja": "CY",
      "semestr": 4,
      "rok": 2
    },
    {
      "nazwa": "Wstęp do cyberbezpieczeństwa",
      "skrot": "WDC",
      "specjalizacja": "CY",
      "semestr": 1,
      "rok": 1
    },
    {
      "nazwa": "Bezpieczeństwo aplikacji internetowych",
      "skrot": "BAI",
      "specjalizacja": "CY",
      "semestr": 1,
      "rok": 1
    },
    {
      "nazwa": "Bezpieczeństwo w sieciach telekomunikacyjnych",
      "skrot": "BST",
      "specjalizacja": "CY",
      "semestr": 2,
      "rok": 1
    },
    {
      "nazwa": "Wykrywanie zagrożeń i reakcja na incydenty",
      "skrot": "WZRI",
      "specjalizacja": "CY",
      "semestr": 2,
      "rok": 1
    },
    {
      "nazwa": "Bezpieczeństwo chmur obliczeniowych",
      "skrot": "BCO",
      "specjalizacja": "CY",
      "semestr": 3,
      "rok": 2
    },
    {
      "nazwa": "Bezpieczeństwo systemów informatycznych",
      "skrot": "BSI",
      "specjalizacja": "CY",
      "semestr": 3,
      "rok": 2
    },
    {
      "nazwa": "Bezpieczeństwo aplikacji mobilnych",
      "skrot": "BAM",
      "specjalizacja": "CY",
      "semestr": 3,
      "rok": 2
    },
    {
      "nazwa": "Audyty i zapewnianie zgodności ze standardami",
      "skrot": "AZZS",
      "specjalizacja": "CY",
      "semestr": 3,
      "rok": 2
    },
    {
      "nazwa": "Testy penetracyjne",
      "skrot": "TP",
      "specjalizacja": "CY",
      "semestr": 3,
      "rok": 2
    },
    {
      "nazwa": "Metody sztucznej inteligencji w cyberbezpieczeństwie",
      "skrot": "MSIC",
      "specjalizacja": "CY",
      "semestr": 3,
      "rok": 2
    },
    {
      "nazwa": "Bezpieczeństwo i hardening systemów operacyjnych",
      "skrot": "BHSO",
      "specjalizacja": "CY",
      "semestr": 4,
      "rok": 2
    },
    {
      "nazwa": "Zaawansowane techniki kryptografii i kryptoanalizy",
      "skrot": "ZTKK",
      "specjalizacja": "CY",
      "semestr": 4,
      "rok": 2
    },
    {
      "nazwa": "Seminarium naukowe",
      "skrot": "SN",
      "specjalizacja": "CY",
      "semestr": 4,
      "rok": 2
    },
    {
      "nazwa": "Seminarium dyplomowe",
      "skrot": "SD",
      "specjalizacja": "CY",
      "semestr": 4,
      "rok": 2
    },
    {
      "nazwa": "Przygotowanie pracy dyplomowej",
      "skrot": "PPD",
      "specjalizacja": "CY",
      "semestr": 4,
      "rok": 2
    }
  ],
  "cyberbezpieczenstwo_wybieralne": {
    "grupa_2": [
      {
        "nazwa": "Technologia blockchain w nauce i biznesie",
        "skrot": "TBNB",
        "specjalizacja": "CY"
      }
    ],
    "grupa_3": [
      {
        "nazwa": "Zarządzanie strategiczne firmą",
        "skrot": "ZSF",
        "specjalizacja": "CY"
      }
    ]
  },
  "data_science": [
    {
      "nazwa": "Techniki uczenia maszynowego",
      "skrot": "TUM",
      "specjalizacja": "DS",
      "semestr": 1,
      "rok": 1
    },
    {
      "nazwa": "Sieci neuronowe i deep learning",
      "skrot": "SNDL",
      "specjalizacja": "DS",
      "semestr": 1,
      "rok": 1
    },
    {
      "nazwa": "Zaawansowane metody uczenia maszynowego",
      "skrot": "ZMUM",
      "specjalizacja": "DS",
      "semestr": 2,
      "rok": 1
    },
    {
      "nazwa": "Big Data",
      "skrot": "BD",
      "specjalizacja": "DS",
      "semestr": 2,
      "rok": 1
    },
    {
      "nazwa": "Systemy rekomendacyjne",
      "skrot": "SR",
      "specjalizacja": "DS",
      "semestr": 3,
      "rok": 2
    },
    {
      "nazwa": "Szeregi czasowe, giełda, ekonomia",
      "skrot": "SCGE",
      "specjalizacja": "DS",
      "semestr": 3,
      "rok": 2
    },
    {
      "nazwa": "Obliczenia ewolucyjne",
      "skrot": "OE",
      "specjalizacja": "DS",
      "semestr": 3,
      "rok": 2
    },
    {
      "nazwa": "Statystyczna analiza danych",
      "skrot": "SAD",
      "specjalizacja": "DS",
      "semestr": 3,
      "rok": 2
    },
    {
      "nazwa": "Przetwarzanie i analiza danych multimedialnych",
      "skrot": "PADM",
      "specjalizacja": "DS",
      "semestr": 3,
      "rok": 2
    },
    {
      "nazwa": "Uczenie maszynowe w diagnostyce medycznej",
      "skrot": "UMDM",
      "specjalizacja": "DS",
      "semestr": 3,
      "rok": 2
    },
    {
      "nazwa": "Projektowanie i analiza eksperymentów",
      "skrot": "PAE",
      "specjalizacja": "DS",
      "semestr": 4,
      "rok": 2
    },
    {
      "nazwa": "Eksploracja danych tekstowych",
      "skrot": "EDT",
      "specjalizacja": "DS",
      "semestr": 4,
      "rok": 2
    },
    {
      "nazwa": "Zarządzanie strategiczne firmą",
      "skrot": "ZSF",
      "specjalizacja": "DS",
      "semestr": 4,
      "rok": 2
    },
    {
      "nazwa": "Seminarium naukowe",
      "skrot": "SN",
      "specjalizacja": "DS",
      "semestr": 4,
      "rok": 2
    },
    {
      "nazwa": "Seminarium dyplomowe",
      "skrot": "SD",
      "specjalizacja": "DS",
      "semestr": 4,
      "rok": 2
    },
    {
      "nazwa": "Przygotowanie pracy dyplomowej",
      "skrot": "PPD",
      "specjalizacja": "DS",
      "semestr": 4,
      "rok": 2
    }
  ]
} as const;

interface Subject {
  nazwa: string;
  skrot: string;
  specjalizacja?: string;
  semestr?: number;
  rok?: number;
}

// Flatten all subjects into a single array for easy searching
const allSubjects: Subject[] = [];

// Add common subjects
subjectsData.przedmioty_wspolne.oglne.forEach(s => allSubjects.push(s));
subjectsData.przedmioty_wspolne.kierunkowe.forEach(s => allSubjects.push(s));
subjectsData.przedmioty_wspolne.wybieralne.grupa_1.forEach(s => allSubjects.push(s));

// Add cybersecurity subjects
subjectsData.cyberbezpieczenstwo.forEach(s => allSubjects.push(s));
subjectsData.cyberbezpieczenstwo_wybieralne.grupa_2.forEach(s => allSubjects.push(s));
subjectsData.cyberbezpieczenstwo_wybieralne.grupa_3.forEach(s => allSubjects.push(s));

// Add data science subjects
subjectsData.data_science.forEach(s => allSubjects.push(s));

/**
 * Normalize string for comparison - remove Polish diacritics, lowercase, remove spaces
 */
function normalize(str: string): string {
  return str
    .toLowerCase()
    .replace(/ą/g, 'a')
    .replace(/ć/g, 'c')
    .replace(/ę/g, 'e')
    .replace(/ł/g, 'l')
    .replace(/ń/g, 'n')
    .replace(/ó/g, 'o')
    .replace(/ś/g, 's')
    .replace(/ź/g, 'z')
    .replace(/ż/g, 'z')
    .replace(/\s+/g, '')
    .replace(/[^\w]/g, '');
}

/**
 * Map subject name from schedule to proper full name
 */
export function mapSubjectName(rawName: string): string {
  if (!rawName) return rawName;

  const normalizedInput = normalize(rawName);

  // Try to find exact match by abbreviation (skrot)
  for (const subject of allSubjects) {
    if (normalize(subject.skrot) === normalizedInput) {
      return subject.nazwa;
    }
  }

  // Try to find by partial match in full name
  for (const subject of allSubjects) {
    const normalizedFullName = normalize(subject.nazwa);

    // Check if input matches start of full name
    if (normalizedFullName.startsWith(normalizedInput)) {
      return subject.nazwa;
    }

    // Check if full name contains input
    if (normalizedFullName.includes(normalizedInput)) {
      return subject.nazwa;
    }
  }

  // Try fuzzy matching - check if any words from input match words in subject name
  const inputWords = rawName.toLowerCase().split(/\s+/);
  let bestMatch: Subject | null = null;
  let bestMatchScore = 0;

  for (const subject of allSubjects) {
    const subjectWords = subject.nazwa.toLowerCase().split(/\s+/);
    let matchScore = 0;

    for (const inputWord of inputWords) {
      if (inputWord.length < 3) continue; // Skip very short words

      for (const subjectWord of subjectWords) {
        if (normalize(subjectWord).includes(normalize(inputWord)) ||
            normalize(inputWord).includes(normalize(subjectWord))) {
          matchScore++;
        }
      }
    }

    if (matchScore > bestMatchScore) {
      bestMatchScore = matchScore;
      bestMatch = subject;
    }
  }

  // Return best match if score is good enough
  if (bestMatch && bestMatchScore >= Math.min(2, inputWords.length)) {
    return bestMatch.nazwa;
  }

  // No match found, return original name
  return rawName;
}

/**
 * Get subject details by name or abbreviation
 */
export function getSubjectDetails(nameOrAbbrev: string): Subject | null {
  const normalized = normalize(nameOrAbbrev);

  for (const subject of allSubjects) {
    if (normalize(subject.skrot) === normalized || normalize(subject.nazwa) === normalized) {
      return subject;
    }
  }

  return null;
}
